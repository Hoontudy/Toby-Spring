# 9.3 애플리케이션 아키텍처
## 9.3.1 계층형 아키텍처
- 성격이 다른 모듈이 강하게 결합되면 변경 시 변경 지점이 많아진다
- 따라서 유연한 경계가 필요하다

### 아키텍처와 SoC
- 애플리케이션을 구성하는 오브젝트들을 비슷한 성격과 책임을 가진것들로 묶을 수 있다.
  - 데이터 액세스 로직은 담당하는 DAO
  - 비즈니스 로직을 구성하는 POJO
  - 웹을 처리하는 코드
- 성격이 다른 것을 아키텍처 레벨로 분리함으로서 독자적인 개발 및 테스트가 가능하다

### 3계층 아키텍처와 수직 계층
- 계층형 아키텍처, 멀티 티어 아키텍처, 3계층 애플리케이션이라고도 한다
- 데이터 액세스 계층, 서비스 계층, 프레젠테이션 계층으로 구분한다
- 1. 데이터 액세스 계층
  - DAO 계층이라고도 불린다
  - DB 이외에도 ERP, 레거시, 메인프레임 접근 역할을 하여 EIS(Enterprise Information System) 계층이라고도 한다
  - 외부 시스템을 호출해서 서비스 이용하는 것은 기반(infrastructure) 계층으로 따로 분류한다
  - 데이터 액세스 계층 내부에서도 수직 계층구조가 가능하다
    - (추상화 레벨 높음) -> DAO 코드 -> JdbcTemplate -> JDBC, 트랜잭션 동기화 -> DataSource -> (추상화 레벨 낮음)
  - 추상화 계층 사용시 DAO 코든느 JdbcTemplate 을 통해서만 코드 작성을 강제할 수 있다.
- 2. 서비스 계층
  - POJO 가 이상적이다
  - 서비스 계층은 DAO 계층을 호출하여 활용한다
  - 서비스 계층은 수직 계층구조를 가질 필요가 없다
  - POJO 로 만들면 기술에 일관된 방식으로 접근가능하여 추상화는 불필요하다
- 2. 프레젠테이션 계층
  - 방화벽 문제, 보안 문제로 HTTP 로 수렴한다
  - 최근 프레젠테이션 로직이 클라이언트로 이동하고 있다
  - 빠르게 기술이 발전함에 따라 빠르게 변화하는 부분이다

### 계층형 아키텍처 설계의 원칙
- 객체지향 원칙은 아키텍처 레벨의 계층과 그 관계에도 동일하게 적용 가능
- 각 계층은 높은 응집도와 계층간 낮은 결합도를 유지해야 한다

```java
public ResultSet findUsersByName(String name) throws SQLException:
// 데이터 계층에서 만들어진 ResultSet 반환, JDBC 기술 종속적인 예외 사용
public List<User> findUsersByName(String name) throws DataAccessException:

```

## 9.3.2 애플리케이션 정보 아키텍처
- 데이터 중심 아키텍처를 다룬다
- DB 나 백엔드 시스템에서 가져온 정보를 값으로 다루고 그 값을 취급하는 코드
- 여러 종류의 아키텍처로 구분 가능하다

### DB/SQL 중심의 로직 구현 방식
- 데이터 중심 구조의 특징은 하나의 업무 트랜잭션에 모든 계층의 코드가 종속되는 경향이 있다는 점이다
- 하나의 단위 업무에 맞추어 각 계층마다의 코드가 존재한다
- 변경 시 전체적으로 변경되며, 종속적이고 배타적이어서 다른 단위 업무에 재사용되기 힘들다
- 따라서 대부분의 로직은 DB 프로시저에 있고 서비스는 가지고온 데이터를 map 형태로 전달할 뿐이다
- 개발하기 쉽다
- 하지만 객체지향을 적용하기 어렵고 코드 재활용도 어렵다
- 로직이 복잡해지면 DB 코드를 알아보기 힘들어지며 결국 변화에 취약한 코드가 된다
- 또한 DB 에서 대부분 로직이 활용되어 DB 리소스 비용도 는다
- 테스트 또한 하기 어렵다
- 스프링의 장점도 취하기 어렵다

### 거대한 서비스 계층 방식
- 그렇다면 DB 에서는 값만 가지고 오고, 대부분의 로직을 서비스로 옮겨보자
- 결국 비대한 서비스 계층으로 이어진다
- 거대 메서드를 여러 메서드로 쪼개게 되지만 결국 전체 클래스 코드 양은 그대로다
- 업무 트랜잭션단위로 집중하여 코드가 만들어저 DAO 공유를 제외하면 코드의 중복도 많다
- 자바 언어의 활용 테스트의 수월성 DAO 코드의 공유가 가능해지지만
- 서비스 계층의 메소드는 크기가 큰 업무 트랜잭션 단위로 만들어저 여전히 계층간 결합도가 크고, 중복 코드도 산재하게 된다
- 공통기능으로 뽑기에도 일반화가 쉽지 않다
- 개발 속도가 빠르고 독립적인 개발이 가능하지만
- 개발자 실력에 따라 이해하기 어려운 코드 혹은 컨벤션이 제각각의 코드가 될 수 있어 오히려 SQL 보다 이해하기 어려워 질수도 있다

